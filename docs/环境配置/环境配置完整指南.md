# IndexTTS2 Mac M2 ç¯å¢ƒé…ç½®å®Œæ•´æŒ‡å—

**æœ€åæ›´æ–°**: 2026-01-22  
**ç³»ç»Ÿ**: macOS (Darwin 23.5.0) - Mac Air M2

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿç¯å¢ƒä¿¡æ¯](#ç³»ç»Ÿç¯å¢ƒä¿¡æ¯)
2. [ç¯å¢ƒé…ç½®æ­¥éª¤](#ç¯å¢ƒé…ç½®æ­¥éª¤)
3. [ä¾èµ–å®‰è£…](#ä¾èµ–å®‰è£…)
4. [ç¯å¢ƒé—®é¢˜è·Ÿè¸ª](#ç¯å¢ƒé—®é¢˜è·Ÿè¸ª)
5. [é…ç½®å·®å¼‚ä¸ä¼˜åŒ–](#é…ç½®å·®å¼‚ä¸ä¼˜åŒ–)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ğŸ–¥ï¸ ç³»ç»Ÿç¯å¢ƒä¿¡æ¯

### ç¡¬ä»¶ä¿¡æ¯
- **CPU**: Apple M2 (Apple Silicon)
- **å†…å­˜**: 16 GB
- **ç£ç›˜**: 460GBæ€»å®¹é‡ï¼Œ36GBå¯ç”¨ï¼ˆ92%å·²ä½¿ç”¨ï¼‰
- **GPU**: Apple M2 é›†æˆGPUï¼ˆæ”¯æŒMPSåŠ é€Ÿï¼‰

### æ“ä½œç³»ç»Ÿ
- **ç³»ç»Ÿ**: macOS
- **ç‰ˆæœ¬**: 14.5 (Darwin 23.5.0)
- **æ¶æ„**: arm64 (Apple Silicon)
- **æ„å»ºç‰ˆæœ¬**: 23F79

### Python ç¯å¢ƒ
- **Pythonç‰ˆæœ¬**: 3.11.3 âœ…
- **Pythonè·¯å¾„**: `/Library/Frameworks/Python.framework/Versions/3.11/bin/python3`
- **pipç‰ˆæœ¬**: 24.1 âœ…
- **condaç‰ˆæœ¬**: 24.3.0 âœ…

### å·²å®‰è£…çš„å…³é”®åº“ï¼ˆå½“å‰çŠ¶æ€ï¼‰
- **PyTorch**: 2.0.0 âœ…
- **TorchAudio**: 2.0.1 âœ…
- **TorchVision**: 0.15.1 âœ…
- **NumPy**: 1.26.4 âœ…ï¼ˆå·²ä¿®å¤å…¼å®¹æ€§ï¼‰
- **SciPy**: 1.10.1 âœ…
- **MPSæ”¯æŒ**: âœ… å¯ç”¨ï¼ˆå·²éªŒè¯ï¼‰
- **Librosa**: 0.11.0 âœ…
- **SoundFile**: 0.13.1 âœ…
- **Pandas**: 3.0.0 âœ…
- **TensorBoard**: 2.20.0 âœ…
- **OmegaConf**: 2.3.0 âœ…
- **Hydra-Core**: 1.3.2 âœ…
- **Jieba**: 0.42.1 âœ…ï¼ˆä¸­æ–‡åˆ†è¯ï¼‰
- **Pypinyin**: 0.55.0 âœ…ï¼ˆä¸­æ–‡æ‹¼éŸ³ï¼‰

---

## ğŸ”§ ç¯å¢ƒé…ç½®æ­¥éª¤

### æ–¹æ³•1: ä½¿ç”¨ Condaï¼ˆæ¨è Mac M2ï¼‰

```bash
# 1. åˆ›å»º conda ç¯å¢ƒï¼ˆæ¨è Python 3.10ï¼‰
conda create -n indextts2 python=3.10 -y
conda activate indextts2

# 2. å®‰è£… PyTorchï¼ˆæ”¯æŒ MPSï¼‰
conda install pytorch torchvision torchaudio -c pytorch

# 3. å®‰è£…ç³»ç»Ÿä¾èµ–
brew install libsndfile

# 4. å®‰è£…é¡¹ç›®ä¾èµ–
pip install -r requirements.txt
```

### æ–¹æ³•2: ä½¿ç”¨ venvï¼ˆå½“å‰ Python 3.11ï¼‰

```bash
# 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# 2. å®‰è£… PyTorchï¼ˆæ”¯æŒ MPSï¼‰
pip install torch torchvision torchaudio

# 3. å®‰è£…ç³»ç»Ÿä¾èµ–
brew install libsndfile

# 4. å®‰è£…é¡¹ç›®ä¾èµ–
pip install -r requirements.txt
```

### æ–¹æ³•3: ä½¿ç”¨ setup.sh è„šæœ¬

```bash
# è‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿå¹¶å®‰è£…
./setup.sh
```

---

## ğŸ“¦ ä¾èµ–å®‰è£…

### ç³»ç»Ÿä¾èµ–ï¼ˆmacOSï¼‰

```bash
# å®‰è£…éŸ³é¢‘å¤„ç†æ‰€éœ€çš„ç³»ç»Ÿåº“
brew install libsndfile

# å¯é€‰ï¼šå®‰è£… ffmpegï¼ˆç”¨äºæ›´å¤šéŸ³é¢‘æ ¼å¼æ”¯æŒï¼‰
brew install ffmpeg
```

### Python æ ¸å¿ƒä¾èµ–

#### å·²å®‰è£…çš„æ ¸å¿ƒä¾èµ–
- âœ… **libsndfile** (ç³»ç»Ÿä¾èµ–)
- âœ… **soundfile** 0.13.1 - éŸ³é¢‘I/O
- âœ… **librosa** 0.11.0 - éŸ³é¢‘å¤„ç†
- âœ… **pandas** 3.0.0 - æ•°æ®å¤„ç†
- âœ… **tensorboard** 2.20.0 - è®­ç»ƒç›‘æ§
- âœ… **omegaconf** 2.3.0 - é…ç½®ç®¡ç†
- âœ… **hydra-core** 1.3.2 - é…ç½®ç®¡ç†
- âœ… **numpy** 1.26.4 - æ•°å€¼è®¡ç®—ï¼ˆå·²ä¿®å¤å…¼å®¹æ€§ï¼‰
- âœ… **scipy** 1.10.1 - ç§‘å­¦è®¡ç®—
- âœ… **matplotlib** 3.7.1 - å¯è§†åŒ–

#### å¯é€‰ä¾èµ–ï¼ˆä¸­æ–‡å¤„ç†ï¼‰
- âœ… **jieba** 0.42.1 - ä¸­æ–‡åˆ†è¯ âœ…
- âœ… **pypinyin** 0.55.0 - ä¸­æ–‡æ‹¼éŸ³ âœ…

### éªŒè¯å®‰è£…

```bash
# éªŒè¯ PyTorch å’Œ MPS
python3 -c "import torch; print('PyTorch:', torch.__version__); print('MPSå¯ç”¨:', torch.backends.mps.is_available())"

# éªŒè¯éŸ³é¢‘åº“
python3 -c "import librosa; import soundfile as sf; print('Librosa:', librosa.__version__); print('SoundFile:', sf.__version__)"

# éªŒè¯æ‰€æœ‰ä¾èµ–
python3 -c "import torch, librosa, soundfile, pandas, tensorboard, omegaconf; print('æ‰€æœ‰æ ¸å¿ƒä¾èµ–å·²å®‰è£…')"
```

---

## ğŸ“Š ç¯å¢ƒé—®é¢˜è·Ÿè¸ª

### âœ… å·²è§£å†³çš„é—®é¢˜

#### 1. ç¼ºå¤±çš„ä¾èµ–åº“ âœ…
**å®Œæˆæ—¶é—´**: 2026-01-22

**è§£å†³æ–¹æ¡ˆ**:
- âœ… å®‰è£…ç³»ç»Ÿä¾èµ–ï¼š`brew install libsndfile`
- âœ… å®‰è£…éŸ³é¢‘å¤„ç†åº“ï¼šsoundfile 0.13.1, librosa 0.11.0
- âœ… å®‰è£…æ•°æ®å¤„ç†åº“ï¼špandas 3.0.0
- âœ… å®‰è£…è®­ç»ƒç›‘æ§ï¼štensorboard 2.20.0
- âœ… å®‰è£…é…ç½®ç®¡ç†ï¼šomegaconf 2.3.0, hydra-core 1.3.2
- âœ… ä¿®å¤ numpy ç‰ˆæœ¬å…¼å®¹æ€§ï¼ˆé™çº§åˆ° 1.26.4ï¼‰
- âœ… éªŒè¯éŸ³é¢‘å¤„ç†åŠŸèƒ½æ­£å¸¸

**å½“å‰çŠ¶æ€**: æ ¸å¿ƒä¾èµ–å·²å…¨éƒ¨å®‰è£…ï¼Œå¯ä»¥è¿è¡Œ IndexTTS2 çš„åŸºæœ¬åŠŸèƒ½

### â³ å¾…è§£å†³çš„é—®é¢˜

#### 2. Python ç‰ˆæœ¬å…¼å®¹æ€§ â³
**é—®é¢˜**: å½“å‰ä½¿ç”¨ Python 3.11.3ï¼Œæ–‡æ¡£æ¨è Python 3.10  
**ä¼˜å…ˆçº§**: ä¸­  
**å»ºè®®**: å¦‚æœé‡åˆ°å…¼å®¹æ€§é—®é¢˜ï¼Œåˆ›å»º Python 3.10 ç¯å¢ƒ

#### 3. environment.yml é…ç½® â³
**çŠ¶æ€**: å·²æ›´æ–°ï¼ˆç§»é™¤ CUDAï¼Œæ”¹ä¸º Python 3.10ï¼ŒPyTorch 2.0+ï¼‰  
**å¾…æµ‹è¯•**: ä½¿ç”¨æ–°é…ç½®åˆ›å»ºç¯å¢ƒå¹¶éªŒè¯

#### 4. Dockerfile é…ç½® â³
**ä¼˜å…ˆçº§**: ä½  
**è¯´æ˜**: Mac M2 é€šå¸¸ä¸éœ€è¦ Dockerï¼Œç›´æ¥è¿è¡Œå³å¯

---

## ğŸ” é…ç½®å·®å¼‚ä¸ä¼˜åŒ–

### Python ç‰ˆæœ¬å»ºè®®

| æ–‡æ¡£ä½ç½® | æ¨èçš„Pythonç‰ˆæœ¬ | è¯´æ˜ |
|---------|-----------------|------|
| IndexTTS2 å®˜æ–¹ | 3.7-3.10 | é€šç”¨è¦æ±‚ |
| Mac M2 æ¨è | **3.10** | **æœ€ä½³å…¼å®¹æ€§** |
| å½“å‰ç³»ç»Ÿ | 3.11.3 | âš ï¸ è¶…å‡ºæ¨èèŒƒå›´ |

**å»ºè®®**: 
- âœ… **æ¨èä½¿ç”¨ Python 3.10**ï¼ˆMac M2 æœ€ä½³å…¼å®¹æ€§ï¼‰
- âš ï¸ å¦‚æœç»§ç»­ä½¿ç”¨ 3.11.3ï¼Œéœ€è¦æµ‹è¯•å…¼å®¹æ€§

### PyTorch ç‰ˆæœ¬

| é…ç½®ä½ç½® | PyTorchç‰ˆæœ¬è¦æ±‚ | è¯´æ˜ |
|---------|---------------|------|
| requirements.txt | >=1.10.0 | æœ€ä½è¦æ±‚ |
| Mac M2 æ¨è | **>=2.0.0** | **æ›´å¥½çš„MPSæ”¯æŒ** |
| å½“å‰å®‰è£… | **2.0.0** | âœ… ç¬¦åˆè¦æ±‚ |

**å»ºè®®**: âœ… å½“å‰ç‰ˆæœ¬ 2.0.0 åˆé€‚ï¼Œæ— éœ€æ›´æ”¹

### environment.yml é…ç½®

**å·²æ›´æ–°é…ç½®**ï¼ˆMac M2 ä¼˜åŒ–ï¼‰:
```yaml
name: indextts2
channels:
  - pytorch
  - conda-forge
  - defaults
dependencies:
  - python=3.10  # âœ… Mac M2æ¨èç‰ˆæœ¬
  - pip
  - pytorch>=2.0.0  # âœ… æ›´å¥½çš„MPSæ”¯æŒ
  - torchaudio>=2.0.0
  # æ³¨æ„ï¼šMac M2 ä¸æ”¯æŒ CUDAï¼Œå·²ç§»é™¤ cudatoolkit
  - numpy>=1.21.0
  - scipy>=1.7.0
  - matplotlib>=3.4.0
  - pandas>=1.3.0
  - scikit-learn>=1.0.0
  - pip:
    - librosa>=0.9.0
    - soundfile>=0.10.0
    - tensorboard>=2.7.0
    - tqdm>=4.62.0
    - pyyaml>=5.4.0
    - omegaconf>=2.1.0
    - hydra-core>=1.1.0
```

---

## ğŸ¯ Mac M2 ç‰¹æ®Šé…ç½®

### MPS (Metal Performance Shaders) åŠ é€Ÿ

```python
import torch

def get_device():
    """è·å–å¯ç”¨è®¾å¤‡"""
    if torch.backends.mps.is_available():
        return torch.device("mps")
    elif torch.cuda.is_available():
        return torch.device("cuda")
    else:
        return torch.device("cpu")

device = get_device()
print(f"ä½¿ç”¨è®¾å¤‡: {device}")
```

### éªŒè¯ MPS æ”¯æŒ

```bash
python3 -c "import torch; print('MPSå¯ç”¨:', torch.backends.mps.is_available()); print('MPSå·²æ„å»º:', torch.backends.mps.is_built())"
```

### æ€§èƒ½å¯¹æ¯”

| è®¾å¤‡ | æ¨ç†é€Ÿåº¦ | è®­ç»ƒé€Ÿåº¦ | å¤‡æ³¨ |
|------|---------|---------|------|
| MPS (M2) | ä¸­ç­‰ | æ…¢ | é€‚åˆæ¨ç† |
| CPU (M2) | æ…¢ | å¾ˆæ…¢ | å¤‡ç”¨æ–¹æ¡ˆ |
| CUDA (NVIDIA) | å¿« | å¿« | æœ€ä½³æ€§èƒ½ |

---

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜1: MPS ä¸æ”¯æŒæŸäº›æ“ä½œ

**è§£å†³æ–¹æ¡ˆ**: 
- æ£€æŸ¥ PyTorch ç‰ˆæœ¬ï¼ˆå»ºè®® 2.0+ï¼‰
- æŸäº›æ“ä½œéœ€è¦å›é€€åˆ° CPU
- ç­‰å¾… PyTorch æ›´æ–°æ”¯æŒ

```python
try:
    output = model(input.to(device))
except RuntimeError as e:
    if "MPS" in str(e):
        print("MPS ä¸æ”¯æŒæ­¤æ“ä½œï¼Œä½¿ç”¨ CPU")
        output = model(input.cpu()).to(device)
```

### é—®é¢˜2: éŸ³é¢‘åº“å®‰è£…å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å®‰è£…ç³»ç»Ÿä¾èµ–
brew install libsndfile ffmpeg

# ä½¿ç”¨ conda å®‰è£…
conda install -c conda-forge librosa soundfile
```

### é—®é¢˜3: NumPy ç‰ˆæœ¬å†²çª

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å¦‚æœé‡åˆ° NumPy 2.x å…¼å®¹æ€§é—®é¢˜ï¼Œé™çº§åˆ° 1.x
pip install "numpy<1.27.0"
```

### é—®é¢˜4: Python ç‰ˆæœ¬å…¼å®¹æ€§

**è§£å†³æ–¹æ¡ˆ**:
```bash
# åˆ›å»º Python 3.10 ç¯å¢ƒ
conda create -n indextts2 python=3.10 -y
conda activate indextts2
```

---

## ğŸ“ ç¯å¢ƒå¿«ç…§å‘½ä»¤

### å¯¼å‡ºå·²å®‰è£…çš„åŒ…

```bash
# pipç¯å¢ƒ
pip freeze > requirements_installed.txt

# condaç¯å¢ƒ
conda env export > environment_snapshot.yml
```

### æ£€æŸ¥ç¯å¢ƒ

```bash
# Pythonä¿¡æ¯
python3 --version
python3 -c "import sys; print(sys.executable)"

# PyTorchå’ŒMPS
python3 -c "import torch; print('PyTorch:', torch.__version__); print('MPS:', torch.backends.mps.is_available())"

# éŸ³é¢‘åº“
python3 -c "import librosa; print('Librosa:', librosa.__version__)"
```

---

## ğŸ”— ç›¸å…³èµ„æº

- [PyTorch MPS æ–‡æ¡£](https://pytorch.org/docs/stable/notes/mps.html)
- [Apple Metal Performance Shaders](https://developer.apple.com/metal/)
- [é¡¹ç›® README](../README.md)
- [å¿«é€Ÿå¼€å§‹æŒ‡å—](../å¿«é€Ÿå¼€å§‹.md)

---

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

1. **ä½¿ç”¨ MPS è¿›è¡Œæ¨ç†**: æ¯” CPU å¿«å¾ˆå¤š
2. **æ‰¹å¤„ç†**: ä¸€æ¬¡å¤„ç†å¤šä¸ªæ ·æœ¬
3. **æ¨¡å‹é‡åŒ–**: å‡å°æ¨¡å‹å¤§å°ï¼Œæé«˜é€Ÿåº¦
4. **äº‘ç«¯è®­ç»ƒ**: å¦‚éœ€è®­ç»ƒï¼Œè€ƒè™‘ä½¿ç”¨äº‘ç«¯ GPU

---

**æç¤º**: Mac M2 çš„ MPS åŠ é€Ÿåœ¨æ¨ç†æ—¶è¡¨ç°è‰¯å¥½ï¼Œä½†è®­ç»ƒå¯èƒ½è¾ƒæ…¢ã€‚å»ºè®®åœ¨ Mac ä¸Šè¿›è¡Œæ¨ç†ï¼Œè®­ç»ƒä½¿ç”¨äº‘ç«¯ GPUã€‚

**æœ€åæ›´æ–°**: 2026-01-22
