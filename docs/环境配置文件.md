# 环境配置文件

**创建时间**: 2025-01-21  
**最后更新**: 2025-01-21  
**系统**: macOS (Darwin 23.5.0)

## 🖥️ 系统环境

### 硬件信息
- **CPU**: Apple M2 (Apple Silicon)
- **内存**: 16 GB
- **磁盘**: 460GB总容量，36GB可用（92%已使用）
- **GPU**: Apple M2 集成GPU（支持MPS加速）

### 操作系统
- **系统**: macOS
- **版本**: 14.5 (Darwin 23.5.0)
- **架构**: arm64 (Apple Silicon)
- **构建版本**: 23F79

## 🐍 Python 环境

### 基础信息
- **Python版本**: 3.11.3
- **Python路径**: `/Library/Frameworks/Python.framework/Versions/3.11/bin/python3`
- **pip版本**: 24.1
- **conda版本**: 24.3.0

### 已安装的关键库
- **PyTorch**: 2.0.0 ✅
- **TorchAudio**: 2.0.1 ✅
- **TorchVision**: 0.15.1 ✅
- **NumPy**: 1.24.3 ✅
- **SciPy**: 1.10.1 ✅
- **MPS支持**: ✅ 可用（已验证）
- **Librosa**: ❌ 未安装
- **SoundFile**: ❌ 未安装

### 版本兼容性
- ⚠️ **注意**: IndexTTS2通常支持Python 3.7-3.10
- 当前使用3.11.3，建议：
  - 使用虚拟环境隔离
  - 如有问题，考虑使用conda创建3.10环境

## 🔧 开发工具

### 包管理器
- **pip**: 24.1 ✅
- **conda**: 24.3.0 ✅
- **Homebrew**: 需要检查

### 虚拟环境
- **venv**: 可用
- **conda**: 可用（已安装miniforge3）
  - base环境: `/Users/MacUser/miniforge3`
  - detectron2环境: `/Users/MacUser/miniforge3/envs/detectron2`

## 📦 项目依赖状态

### 核心依赖（requirements.txt）
```
torch>=1.10.0          ✅ 已安装 (2.0.0)
torchaudio>=0.10.0    ✅ 已安装 (2.0.1)
torchvision>=0.10.0   ✅ 已安装 (0.15.1)
numpy>=1.21.0         ✅ 已安装 (1.24.3)
scipy>=1.7.0          ✅ 已安装 (1.10.1)
librosa>=0.9.0        ❌ 未安装
soundfile>=0.10.0     ❌ 未安装
pandas>=1.3.0         ⚠️  需要检查
matplotlib>=3.4.0     ⚠️  需要检查
tensorboard>=2.7.0    ⚠️  需要检查
```

### 系统依赖（macOS）
- **libsndfile**: 需要安装（通过Homebrew）
- **ffmpeg**: 可选（用于音频处理）

## 🎯 设备适配

### MPS (Metal Performance Shaders)
- **状态**: ✅ 可用
- **验证命令**: 
  ```python
  import torch
  torch.backends.mps.is_available()  # True
  ```
- **用途**: GPU加速推理（比CPU快）

### CUDA
- **状态**: ❌ 不可用（Mac M2不支持NVIDIA CUDA）
- **替代方案**: 使用MPS进行GPU加速

## 📁 项目路径

### 工作目录
```
/Users/MacUser/Documents/ai/IndexTTS2
```

### 关键目录
- **数据目录**: `data/`
- **模型目录**: `checkpoints/`
- **输出目录**: `outputs/`
- **配置目录**: `configs/`
- **脚本目录**: `scripts/`

## 🔄 环境配置方案

### 方案1: 使用Conda（推荐Mac M2）
```bash
# 创建Python 3.10环境（兼容性更好）
conda create -n indextts2 python=3.10 -y
conda activate indextts2

# 安装PyTorch（支持MPS）
conda install pytorch torchvision torchaudio -c pytorch

# 安装其他依赖
pip install -r requirements.txt
```

### 方案2: 使用venv（当前Python 3.11）
```bash
# 创建虚拟环境
python3 -m venv venv
source venv/bin/activate

# 安装依赖（PyTorch已安装）
pip install -r requirements.txt
```

### 方案3: 使用setup.sh脚本
```bash
# 自动检测系统并安装
./setup.sh
```

## ⚙️ 环境变量

### 推荐设置
```bash
# Python路径
export PYTHONPATH=/Users/MacUser/Documents/ai/IndexTTS2:$PYTHONPATH

# 设备选择（Mac M2）
export DEVICE=mps  # 或 cpu
```

## 📋 待完成任务

### 环境配置
- [ ] 安装librosa和soundfile
- [ ] 安装其他缺失的依赖
- [ ] 验证所有依赖是否正常工作
- [ ] 测试MPS加速功能

### 系统优化
- [ ] 清理磁盘空间（当前92%已使用）
- [ ] 安装Homebrew（如未安装）
- [ ] 安装libsndfile系统依赖

## 🐛 已知问题

1. **Python版本**: 3.11.3可能过新，建议使用3.10
2. **磁盘空间**: 36GB可用，建议清理或扩展
3. **依赖缺失**: 多个关键库未安装

## 📝 环境快照命令

### 导出已安装的包
```bash
# pip环境
pip freeze > requirements_installed.txt

# conda环境
conda env export > environment_snapshot.yml
```

### 检查环境
```bash
# Python信息
python3 --version
python3 -c "import sys; print(sys.executable)"

# PyTorch和MPS
python3 -c "import torch; print('PyTorch:', torch.__version__); print('MPS:', torch.backends.mps.is_available())"

# 音频库
python3 -c "import librosa; print('Librosa:', librosa.__version__)" 2>/dev/null || echo "Librosa未安装"
```

## 🔗 相关文档

- [环境检查报告](环境检查报告.md)
- [Mac M2环境配置指南](Mac_M2环境配置指南.md)
- [用户目标和使用场景](用户目标和使用场景.md)

---

**维护说明**: 此文件应定期更新，记录环境变化和配置调整。
